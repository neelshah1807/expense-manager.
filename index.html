<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Expense Manager</title>

<style>
body { font-family: Arial; background:#f4f6f8; padding:20px }
h2 { text-align:center }
table { width:100%; border-collapse:collapse; background:#fff }
th,td { border:1px solid #000; padding:6px; text-align:center }
th { background:#2c3e50; color:#fff }
input,button { padding:6px }
.form { display:flex; gap:10px; margin-bottom:15px }
.form input { flex:1 }
button { background:#27ae60; color:#fff; border:none; cursor:pointer }
button:hover { background:#219150 }
</style>
</head>

<body>

<h2>Expense Manager</h2>

<div class="form">
  <input id="name" placeholder="Name">
  <input id="date" type="date">
  <input id="details" placeholder="Details">
  <input id="amount" type="number" placeholder="Amount">
  <input id="credit" type="number" placeholder="Credit">
  <button onclick="add()">Add</button>
</div>

<table id="table">
<thead>
<tr>
  <th>Sr No</th>
  <th>Name</th>
  <th>Date</th>
  <th>Details</th>
  <th>Amount</th>
  <th>Credit</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>

<br>
<button onclick="exportAndSave()">Export Excel & Save</button>

<p align="center">
Total Expense: â‚¹<span id="te">0</span> |
Total Credit: â‚¹<span id="tc">0</span> |
Balance: â‚¹<span id="bal">0</span>
</p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwiye5jSCmCqqHJJYf3hXmAfIUoCY9l9A63bHdUtAdWfrNV-UeeeIcAlAewjKGjCqLCrg/exec";

let sr=0, te=0, tc=0;

function add() {
  if(!name.value || !date.value){
    alert("Name & Date required"); return;
  }

  sr++;
  const r = body.insertRow();
  r.insertCell(0).innerText = sr;
  r.insertCell(1).innerText = name.value;
  r.insertCell(2).innerText = date.value;
  r.insertCell(3).innerText = details.value;
  r.insertCell(4).innerText = amount.value || 0;
  r.insertCell(5).innerText = credit.value || 0;

  te += Number(amount.value||0);
  tc += Number(credit.value||0);

  teSpan();
  name.value=date.value=details.value=amount.value=credit.value="";
}

function teSpan(){
  teEl.textContent = te;
  tcEl.textContent = tc;
  balEl.textContent = tc-te;
}

const teEl=document.getElementById("te");
const tcEl=document.getElementById("tc");
const balEl=document.getElementById("bal");

function exportAndSave(){
  if(body.rows.length===0){
    alert("No data"); return;
  }

  // ðŸ”¹ Prepare data for Google Sheet
  const data=[...body.rows].map(r=>({
    srno:r.cells[0].innerText,
    name:r.cells[1].innerText,
    date:r.cells[2].innerText,
    details:r.cells[3].innerText,
    amount:r.cells[4].innerText,
    credit:r.cells[5].innerText
  }));

  fetch(WEB_APP_URL,{
    method:"POST",
    body:JSON.stringify(data)
  });

  // ðŸ”¹ Create STANDARD CSV
  let csv="Sr No,Name,Date,Details,Amount,Credit\n";
  data.forEach(r=>{
    csv+=`${r.srno},"${r.name}",${r.date},"${r.details}",${r.amount},${r.credit}\n`;
  });

  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Expense_Report.csv";
  a.click();

  alert("Master Sheet Updated & Excel Downloaded");
}
</script>

</body>
</html>
