<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Manager</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    padding:20px;
}
h2 {
    text-align:center;
}
.common {
    background:#fff;
    padding:15px;
    border-radius:8px;
    margin-bottom:15px;
}
table {
    width:100%;
    border-collapse:collapse;
    background:#fff;
}
th, td {
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}
th {
    background:#2c3e50;
    color:#fff;
}
input {
    padding:6px;
    width:100%;
    box-sizing:border-box;
}
button {
    padding:8px 14px;
    background:#27ae60;
    color:#fff;
    border:none;
    cursor:pointer;
}
button:hover {
    background:#219150;
}
.summary {
    margin-top:15px;
    font-weight:bold;
    text-align:center;
}
</style>
</head>

<body>

<h2>Expense Manager</h2>

<!-- INPUT ROW (UNCHANGED) -->
<div class="common">
<table>
<tr>
    <td><input id="name" placeholder="Name of person"></td>
    <td><input id="date" type="date"></td>
    <td><input id="details" placeholder="Expense details"></td>
    <td><input id="amount" type="number" placeholder="Amount"></td>
    <td><input id="credit" type="number" placeholder="Credit"></td>
    <td>
        <button type="button" onclick="addExpense()">Add</button>
    </td>
</tr>
</table>
</div>

<!-- DATA TABLE (UNCHANGED) -->
<table>
<thead>
<tr>
    <th>Sr.no</th>
    <th>Name of person</th>
    <th>Date</th>
    <th>Expense details</th>
    <th>Amount</th>
    <th>Credit</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<!-- SUMMARY (UNCHANGED) -->
<div class="summary">
    Total Expense: â‚¹ <span id="totalExpense">0</span> |
    Total Credit: â‚¹ <span id="totalCredit">0</span> |
    Balance: â‚¹ <span id="balance">0</span>
</div>

<!-- âœ… NEW: SUBMIT BUTTON (ONLY ADDITION) -->
<div style="text-align:center; margin-top:15px;">
    <button type="button" onclick="submitData()">Submit</button>
</div>

<script>
/* ================= EXISTING WORKING LOGIC (UNCHANGED) ================= */

let srNo = 0;
let totalExpense = 0;
let totalCredit = 0;

function addExpense() {
    const name = document.getElementById("name").value.trim();
    const date = document.getElementById("date").value;
    const details = document.getElementById("details").value.trim();
    const amount = Number(document.getElementById("amount").value) || 0;
    const credit = Number(document.getElementById("credit").value) || 0;

    if (!name || !date) {
        alert("Name and Date are required");
        return;
    }

    srNo++;

    const tbody = document.getElementById("tbody");
    const row = tbody.insertRow();

    row.insertCell(0).innerText = srNo;
    row.insertCell(1).innerText = name;
    row.insertCell(2).innerText = date;
    row.insertCell(3).innerText = details;
    row.insertCell(4).innerText = amount;
    row.insertCell(5).innerText = credit;

    totalExpense += amount;
    totalCredit += credit;

    document.getElementById("totalExpense").innerText = totalExpense;
    document.getElementById("totalCredit").innerText = totalCredit;
    document.getElementById("balance").innerText = totalCredit - totalExpense;

    document.getElementById("name").value = "";
    document.getElementById("date").value = "";
    document.getElementById("details").value = "";
    document.getElementById("amount").value = "";
    document.getElementById("credit").value = "";
}

/* ================= NEW CODE BELOW (ONLY ADDITION) ================= */

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwiye5jSCmCqqHJJYf3hXmAfIUoCY9l9A63bHdUtAdWfrNV-UeeeIcAlAewjKGjCqLCrg/exec";

function submitData() {

    const tbody = document.getElementById("tbody");
    if (tbody.rows.length === 0) {
        alert("No data to submit");
        return;
    }

    // ðŸ”¹ Collect table data
    const data = [];
    for (let row of tbody.rows) {
        data.push({
            srno: row.cells[0].innerText,
            name: row.cells[1].innerText,
            date: row.cells[2].innerText,
            details: row.cells[3].innerText,
            amount: row.cells[4].innerText,
            credit: row.cells[5].innerText
        });
    }

    // ðŸ”¹ Send to MASTER Google Sheet
    fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify(data)
    });

    // ðŸ”¹ Individual Excel (CSV â€“ standard)
    let csv = "Sr.no,Name,Date,Details,Amount,Credit\n";
    data.forEach(r => {
        csv += `${r.srno},"${r.name}",${r.date},"${r.details}",${r.amount},${r.credit}\n`;
    });

    const blob = new Blob([csv], { type: "text/csv" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "Expense_Report.csv";
    a.click();

    alert("Submitted successfully\nMaster updated & Excel downloaded");
}
</script>

</body>
</html>
