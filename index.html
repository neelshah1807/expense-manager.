<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Expense Manager</title>

<style>
body { font-family: Arial; background:#f4f6f8; padding:20px }
h2 { text-align:center }
table { width:100%; border-collapse:collapse; background:#fff }
th,td { border:1px solid #000; padding:6px; text-align:center }
th { background:#2c3e50; color:#fff }
input,button { padding:6px }
.form { display:flex; gap:10px; margin-bottom:15px }
.form input { flex:1 }
button { background:#27ae60; color:#fff; border:none; cursor:pointer }
button:hover { background:#219150 }
</style>
</head>

<body>

<h2>Expense Manager</h2>

<div class="form">
  <input id="inpName" placeholder="Name">
  <input id="inpDate" type="date">
  <input id="inpDetails" placeholder="Details">
  <input id="inpAmount" type="number" placeholder="Amount">
  <input id="inpCredit" type="number" placeholder="Credit">
  <button onclick="addRow()">Add</button>
</div>

<table>
<thead>
<tr>
  <th>Sr No</th>
  <th>Name</th>
  <th>Date</th>
  <th>Details</th>
  <th>Amount</th>
  <th>Credit</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<br>
<button onclick="exportAndSave()">Export Excel & Save</button>

<p align="center">
Total Expense: ₹<span id="te">0</span> |
Total Credit: ₹<span id="tc">0</span> |
Balance: ₹<span id="bal">0</span>
</p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwiye5jSCmCqqHJJYf3hXmAfIUoCY9l9A63bHdUtAdWfrNV-UeeeIcAlAewjKGjCqLCrg/exec";

let sr = 0, te = 0, tc = 0;

function addRow() {
  const name = document.getElementById("inpName").value.trim();
  const date = document.getElementById("inpDate").value;
  const details = document.getElementById("inpDetails").value.trim();
  const amount = Number(document.getElementById("inpAmount").value) || 0;
  const credit = Number(document.getElementById("inpCredit").value) || 0;

  if (!name || !date) {
    alert("Name and Date required");
    return;
  }

  sr++;
  const tbody = document.getElementById("tbody");
  const row = tbody.insertRow();

  row.insertCell(0).innerText = sr;
  row.insertCell(1).innerText = name;
  row.insertCell(2).innerText = date;
  row.insertCell(3).innerText = details;
  row.insertCell(4).innerText = amount;
  row.insertCell(5).innerText = credit;

  te += amount;
  tc += credit;

  document.getElementById("te").innerText = te;
  document.getElementById("tc").innerText = tc;
  document.getElementById("bal").innerText = tc - te;

  document.getElementById("inpName").value = "";
  document.getElementById("inpDate").value = "";
  document.getElementById("inpDetails").value = "";
  document.getElementById("inpAmount").value = "";
  document.getElementById("inpCredit").value = "";
}

function exportAndSave() {
  const tbody = document.getElementById("tbody");
  if (tbody.rows.length === 0) {
    alert("No data to export");
    return;
  }

  const data = [];
  for (let r of tbody.rows) {
    data.push({
      srno: r.cells[0].innerText,
      name: r.cells[1].innerText,
      date: r.cells[2].innerText,
      details: r.cells[3].innerText,
      amount: r.cells[4].innerText,
      credit: r.cells[5].innerText
    });
  }

  // ✅ SAVE TO GOOGLE SHEET
  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(data)
  });

  // ✅ STANDARD CSV EXPORT
  let csv = "Sr No,Name,Date,Details,Amount,Credit\n";
  data.forEach(r => {
    csv += `${r.srno},"${r.name}",${r.date},"${r.details}",${r.amount},${r.credit}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Expense_Report.csv";
  a.click();

  alert("Saved to Master Sheet & Excel Downloaded");
}
</script>

</body>
</html>

